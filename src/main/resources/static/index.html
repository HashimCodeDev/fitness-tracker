<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTrack - Modern Fitness Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        },
                        success: {
                            500: '#10b981',
                            600: '#059669'
                        },
                        warning: {
                            500: '#f59e0b',
                            600: '#d97706'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'bounce-in': 'bounceIn 0.5s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease-out; }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dasharray 0.35s;
            transform-origin: 50% 50%;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: rgba(156, 163, 175, 0.5); 
            border-radius: 3px; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { 
            background: rgba(156, 163, 175, 0.8); 
        }
        
        /* Mobile navigation */
        .mobile-nav {
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-nav.active {
            transform: translateY(0);
        }
        
        /* Responsive grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Chart container fix */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .chart-container canvas {
            max-height: 300px !important;
            max-width: 100% !important;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        /* Workout Modal Styles */
        .modal-backdrop {
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease-out;
        }
        
        .modal-content {
            animation: slideUp 0.3s ease-out;
        }
        
        /* Exercise Row Animations */
        .exercise-row {
            animation: slideUp 0.3s ease-out;
        }
        
        /* Hover effects for workout cards */
        .workout-card {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .workout-card:hover {
            border-color: rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.05);
        }
        
        /* Template card hover effects */
        .template-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .template-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .template-card:hover::before {
            left: 100%;
        }
        
        /* Form input focus effects */
        .form-input {
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        /* Button loading state */
        .btn-loading {
            position: relative;
            color: transparent;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">

    <!-- Login/Register Page -->
    <div id="auth-wrapper" class="min-h-screen flex items-center justify-center p-4 page active">
        <div class="w-full max-w-md">
            <!-- Logo Section -->
            <div class="text-center mb-8 animate-bounce-in">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl mb-4">
                    <i class="fas fa-dumbbell text-2xl text-white"></i>
                </div>
                <h1 class="text-4xl font-bold text-white mb-2">FitTrack</h1>
                <p class="text-slate-400">Your personal fitness companion</p>
            </div>
            
            <!-- Login Form -->
            <div id="login-form" class="glass-effect rounded-2xl p-8 animate-slide-up">
                <h2 class="text-2xl font-semibold text-white mb-6 text-center">Welcome Back</h2>
                <form class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                            <input name="email" type="email" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                            <input name="password" type="password" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your password" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105">
                        Sign In
                    </button>
                </form>
                <p class="text-center text-slate-400 mt-6">
                    Don't have an account? 
                    <button id="show-register" class="text-blue-400 hover:text-blue-300 font-medium transition-colors">Sign Up</button>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="register-form" class="glass-effect rounded-2xl p-8 animate-slide-up" style="display: none;">
                <h2 class="text-2xl font-semibold text-white mb-6 text-center">Create Account</h2>
                <form class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Full Name</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                            <input name="name" type="text" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your name" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                            <input name="email" type="email" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                            <input name="password" type="password" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Create a password" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105">
                        Create Account
                    </button>
                </form>
                <p class="text-center text-slate-400 mt-6">
                    Already have an account? 
                    <button id="show-login" class="text-blue-400 hover:text-blue-300 font-medium transition-colors">Sign In</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-wrapper" class="min-h-screen flex flex-col lg:flex-row page" style="display: none;">
        <!-- Desktop Sidebar -->
        <nav class="hidden lg:flex lg:w-72 bg-slate-900/50 backdrop-blur-xl border-r border-slate-700/50 p-6 flex-col">
            <div class="flex items-center gap-3 mb-10">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-dumbbell text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-white">FitTrack</h1>
            </div>
            
            <div class="space-y-2 flex-grow">
                <button data-page="dashboard-page" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:text-white hover:bg-slate-800/50 transition-all active">
                    <i class="fas fa-home w-5"></i>
                    <span class="font-medium">Dashboard</span>
                </button>
                <button data-page="workouts-page" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:text-white hover:bg-slate-800/50 transition-all">
                    <i class="fas fa-dumbbell w-5"></i>
                    <span class="font-medium">Workouts</span>
                </button>
                <button data-page="history-page" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:text-white hover:bg-slate-800/50 transition-all">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="font-medium">Progress</span>
                </button>
                <button data-page="profile-page" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:text-white hover:bg-slate-800/50 transition-all">
                    <i class="fas fa-user w-5"></i>
                    <span class="font-medium">Profile</span>
                </button>
            </div>
            
            <div class="space-y-3 mt-6">
                <button id="add-workout-btn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i>
                    <span>New Workout</span>
                </button>
                <button id="logout-btn" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-red-400 hover:bg-red-500/10 transition-all">
                    <i class="fas fa-sign-out-alt w-5"></i>
                    <span class="font-medium">Logout</span>
                </button>
            </div>
        </nav>

        <!-- Mobile Header -->
        <header class="lg:hidden bg-slate-900/50 backdrop-blur-xl border-b border-slate-700/50 p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-dumbbell text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold text-white">FitTrack</h1>
            </div>
            <button id="mobile-menu-btn" class="text-white p-2">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto custom-scrollbar">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active p-4 lg:p-8">
                <div class="max-w-7xl mx-auto">
                    <!-- Header -->
                    <div class="mb-8">
                        <h1 class="text-3xl lg:text-4xl font-bold text-white mb-2">Good Morning, Alex! ðŸ‘‹</h1>
                        <p class="text-slate-400 text-lg">Ready to crush your fitness goals today?</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="stats-grid mb-8">
                        <div class="glass-effect rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-fire text-blue-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-white font-semibold">Calories Burned</h3>
                                        <p class="text-slate-400 text-sm">Today</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-bold text-white">342</p>
                                    <p class="text-green-400 text-sm">+12% from yesterday</p>
                                </div>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" style="width: 68%"></div>
                            </div>
                        </div>

                        <div class="glass-effect rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-clock text-green-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-white font-semibold">Workout Time</h3>
                                        <p class="text-slate-400 text-sm">This week</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-bold text-white">4.5h</p>
                                    <p class="text-green-400 text-sm">Goal: 5h</p>
                                </div>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full" style="width: 90%"></div>
                            </div>
                        </div>

                        <div class="glass-effect rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-trophy text-purple-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-white font-semibold">Streak</h3>
                                        <p class="text-slate-400 text-sm">Current</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-bold text-white">7 days</p>
                                    <p class="text-purple-400 text-sm">Personal best!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="mb-8">
                        <div class="glass-effect rounded-2xl p-6 max-w-2xl mx-auto">
                            <h3 class="text-xl font-semibold text-white mb-4">Workout Distribution</h3>
                            <div class="chart-container">
                                <canvas id="workoutChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="glass-effect rounded-2xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-6">Recent Workouts</h3>
                        <div class="space-y-4">
                            <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-xl">
                                <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-dumbbell text-blue-400"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-white font-medium">Upper Body Strength</h4>
                                    <p class="text-slate-400 text-sm">45 minutes â€¢ 320 calories</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-white text-sm">Today</p>
                                    <p class="text-green-400 text-sm">Completed</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-xl">
                                <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-running text-green-400"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-white font-medium">Morning Cardio</h4>
                                    <p class="text-slate-400 text-sm">30 minutes â€¢ 280 calories</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-white text-sm">Yesterday</p>
                                    <p class="text-green-400 text-sm">Completed</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workouts Page -->
            <div id="workouts-page" class="page p-4 lg:p-8">
                <div class="max-w-7xl mx-auto">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
                        <div>
                            <h1 class="text-3xl lg:text-4xl font-bold text-white mb-2">Workouts</h1>
                            <p class="text-slate-400">Create and track your workout sessions</p>
                            <p class="text-slate-500 text-xs mt-1 hidden sm:block">
                                <i class="fas fa-keyboard text-xs mr-1"></i>
                                Tip: Press Ctrl+N to create a new workout
                            </p>
                        </div>
                        <button id="create-workout-btn" class="mt-4 sm:mt-0 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-plus mr-2"></i>Create Workout
                        </button>
                    </div>

                    <!-- Workout Templates -->
                    <div class="mb-8">
                        <h2 class="text-xl font-semibold text-white mb-4">Quick Start Templates</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="glass-effect rounded-2xl p-6 card-hover cursor-pointer template-card" onclick="createFromTemplate('strength')">
                                <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-2xl flex items-center justify-center mb-4">
                                    <i class="fas fa-dumbbell text-2xl text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">Strength Training</h3>
                                <p class="text-slate-400 mb-4">Build muscle with compound movements</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-slate-500">5 exercises</span>
                                    <i class="fas fa-arrow-right text-blue-400"></i>
                                </div>
                            </div>

                            <div class="glass-effect rounded-2xl p-6 card-hover cursor-pointer template-card" onclick="createFromTemplate('cardio')">
                                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-4">
                                    <i class="fas fa-running text-2xl text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">Cardio Blast</h3>
                                <p class="text-slate-400 mb-4">High-intensity cardiovascular workout</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-slate-500">6 exercises</span>
                                    <i class="fas fa-arrow-right text-blue-400"></i>
                                </div>
                            </div>

                            <div class="glass-effect rounded-2xl p-6 card-hover cursor-pointer template-card" onclick="createFromTemplate('flexibility')">
                                <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-4">
                                    <i class="fas fa-leaf text-2xl text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">Flexibility & Mobility</h3>
                                <p class="text-slate-400 mb-4">Improve range of motion and recovery</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-slate-500">8 exercises</span>
                                    <i class="fas fa-arrow-right text-blue-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Workouts -->
                    <div class="glass-effect rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold text-white">Recent Workouts</h2>
                            <button onclick="loadWorkouts()" class="text-blue-400 hover:text-blue-300 text-sm">
                                <i class="fas fa-refresh mr-1"></i>Refresh
                            </button>
                        </div>
                        <div id="recent-workouts" class="space-y-4">
                            <div class="text-center py-8 text-slate-400">
                                <i class="fas fa-dumbbell text-4xl mb-4 opacity-50"></i>
                                <p>No workouts yet. Create your first workout!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workout Creation Modal -->
            <div id="workout-modal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4" style="display: none;">
                <div class="glass-effect rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scrollbar modal-content">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-semibold text-white">Create Workout</h2>
                        <button id="close-modal" class="text-slate-400 hover:text-white transition-colors p-2 hover:bg-slate-700/50 rounded-lg">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <form id="workout-form" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Workout Title</label>
                            <input id="workout-title" type="text" class="form-input w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter workout title" required>
                        </div>

                        <div>
                            <div class="flex items-center justify-between mb-4">
                                <label class="text-sm font-medium text-slate-300">Exercises</label>
                                <button type="button" id="add-exercise" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-all transform hover:scale-105">
                                    <i class="fas fa-plus mr-1"></i>Add Exercise
                                </button>
                            </div>
                            <div id="exercises-container" class="space-y-4">
                                <!-- Exercises will be added here -->
                            </div>
                        </div>

                        <div class="flex gap-4 pt-4 border-t border-slate-700">
                            <button type="button" id="cancel-workout" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                                Cancel
                            </button>
                            <button type="submit" id="save-workout-btn" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-xl transition-all transform hover:scale-105">
                                <i class="fas fa-save mr-2"></i>Save Workout
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- History/Progress Page -->
            <div id="history-page" class="page p-4 lg:p-8">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl lg:text-4xl font-bold text-white mb-2">Progress & History</h1>
                        <p class="text-slate-400">Track your fitness journey over time</p>
                    </div>

                    <!-- Progress Overview -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div class="lg:col-span-2 glass-effect rounded-2xl p-6">
                            <h3 class="text-xl font-semibold text-white mb-4">Monthly Progress</h3>
                            <div class="chart-container">
                                <canvas id="progressChart"></canvas>
                            </div>
                        </div>
                        <div class="glass-effect rounded-2xl p-6">
                            <h3 class="text-xl font-semibold text-white mb-6">Goals Progress</h3>
                            <div class="space-y-6">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-white font-medium">Weight Loss</span>
                                        <span class="text-blue-400">75%</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-white font-medium">Muscle Gain</span>
                                        <span class="text-green-400">60%</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full" style="width: 60%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-white font-medium">Endurance</span>
                                        <span class="text-purple-400">85%</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 h-3 rounded-full" style="width: 85%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Workout History -->
                    <div class="glass-effect rounded-2xl p-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                            <h3 class="text-xl font-semibold text-white">Workout History</h3>
                            <div class="flex gap-2 mt-4 sm:mt-0">
                                <button class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm">All</button>
                                <button class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm hover:bg-slate-600">Strength</button>
                                <button class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm hover:bg-slate-600">Cardio</button>
                            </div>
                        </div>
                        <div class="space-y-4" id="workout-history">
                            <!-- Workout history items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page p-4 lg:p-8">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl lg:text-4xl font-bold text-white mb-2">Profile</h1>
                        <p class="text-slate-400">Manage your account and preferences</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Profile Info -->
                        <div class="lg:col-span-2 glass-effect rounded-2xl p-6">
                            <h3 class="text-xl font-semibold text-white mb-6">Personal Information</h3>
                            <form class="space-y-6" onsubmit="updateProfile(event)">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">Full Name</label>
                                    <input name="name" type="text" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                                    <input name="email" type="email" readonly class="w-full bg-slate-700/50 border border-slate-600 rounded-xl px-4 py-3 text-slate-400 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Age</label>
                                        <input name="age" type="number" min="1" max="120" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Height (cm)</label>
                                        <input name="height" type="number" min="50" max="300" step="0.1" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Weight (kg)</label>
                                        <input name="weight" type="number" min="20" max="500" step="0.1" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                                <div id="bmi-display" class="bg-slate-800/30 rounded-xl p-4 text-center" style="display: none;">
                                    <span class="text-slate-400">BMI: </span>
                                    <span id="bmi-value" class="text-white font-semibold text-lg">-</span>
                                </div>
                                <button type="submit" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300">
                                    Update Profile
                                </button>
                            </form>
                            
                            <!-- Toast Container -->
                            <div id="toast-container"></div>
                            </form>
                        </div>

                        <!-- Profile Stats -->
                        <div class="space-y-6">
                            <div class="glass-effect rounded-2xl p-6 text-center">
                                <div class="w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <i class="fas fa-user text-3xl text-white"></i>
                                </div>
                                <h3 id="profile-display-name" class="text-xl font-semibold text-white mb-2">Loading...</h3>
                                <p id="profile-display-email" class="text-slate-400">Loading...</p>
                            </div>

                            <div class="glass-effect rounded-2xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Quick Stats</h4>
                                <div class="space-y-4" id="profile-stats">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Total Workouts</span>
                                        <span class="text-white font-semibold">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Total Exercises</span>
                                        <span class="text-white font-semibold">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">BMI</span>
                                        <span class="text-white font-semibold">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Member Since</span>
                                        <span class="text-white font-semibold">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="lg:hidden mobile-nav fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-xl border-t border-slate-700/50 p-4">
            <div class="flex justify-around">
                <button data-page="dashboard-page" class="nav-btn flex flex-col items-center gap-1 p-2 text-blue-400">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs">Home</span>
                </button>
                <button data-page="workouts-page" class="nav-btn flex flex-col items-center gap-1 p-2 text-slate-400">
                    <i class="fas fa-dumbbell text-xl"></i>
                    <span class="text-xs">Workouts</span>
                </button>
                <button id="mobile-add-workout" class="flex flex-col items-center gap-1 p-2">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-plus text-white"></i>
                    </div>
                </button>
                <button data-page="history-page" class="nav-btn flex flex-col items-center gap-1 p-2 text-slate-400">
                    <i class="fas fa-chart-line text-xl"></i>
                    <span class="text-xs">Progress</span>
                </button>
                <button data-page="profile-page" class="nav-btn flex flex-col items-center gap-1 p-2 text-slate-400">
                    <i class="fas fa-user text-xl"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- JavaScript -->
    <script>
        // App State
        let currentUser = null;
        let currentPage = 'dashboard-page';

        // DOM Elements
        const authWrapper = document.getElementById('auth-wrapper');
        const appWrapper = document.getElementById('app-wrapper');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');
        const mobileNav = document.querySelector('.mobile-nav');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Check if user is already logged in
            const savedEmail = localStorage.getItem('userEmail');
            if (savedEmail) {
                currentUser = { email: savedEmail, name: savedEmail.split('@')[0] };
                showApp();
                loadDashboardData();
                loadUserProfile();
            }
        });

        // Event Listeners
        function setupEventListeners() {
            // Auth form toggles
            showRegisterBtn.addEventListener('click', () => {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });

            showLoginBtn.addEventListener('click', () => {
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });

            // Form submissions
            loginForm.querySelector('form').addEventListener('submit', handleLogin);
            registerForm.querySelector('form').addEventListener('submit', handleRegister);

            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetPage = btn.getAttribute('data-page');
                    if (targetPage) {
                        navigateToPage(targetPage);
                    }
                });
            });

            // Mobile menu toggle
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileNav.classList.toggle('active');
                });
            }

            // Logout
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Add workout buttons
            document.getElementById('add-workout-btn')?.addEventListener('click', startWorkout);
            document.getElementById('mobile-add-workout')?.addEventListener('click', startWorkout);
            
            // Setup workout-specific event listeners
            setupWorkoutEventListeners();
            
            // BMI calculation listeners
            document.addEventListener('input', function(e) {
                if (e.target.name === 'height' || e.target.name === 'weight') {
                    calculateBMI();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Escape key to close modal
                if (e.key === 'Escape') {
                    const modal = document.getElementById('workout-modal');
                    if (modal && modal.style.display !== 'none') {
                        closeWorkoutModal();
                    }
                }
                
                // Ctrl/Cmd + N to create new workout
                if ((e.ctrlKey || e.metaKey) && e.key === 'n' && currentPage === 'workouts-page') {
                    e.preventDefault();
                    openWorkoutModal();
                }
                
                // Ctrl/Cmd + S to save workout (when modal is open)
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    const modal = document.getElementById('workout-modal');
                    if (modal && modal.style.display !== 'none') {
                        e.preventDefault();
                        const form = document.getElementById('workout-form');
                        if (form) {
                            form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
                        }
                    }
                }
            });
        }

        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email') || e.target.querySelector('input[type="email"]').value;
            const password = formData.get('password') || e.target.querySelector('input[type="password"]').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    // Load user data
                    const userResponse = await fetch(`/api/users/profile?email=${encodeURIComponent(email)}`);
                    let userData = { email, name: email.split('@')[0] };
                    
                    if (userResponse.ok) {
                        const user = await userResponse.json();
                        userData = { ...user, email };
                    }
                    
                    currentUser = userData;
                    localStorage.setItem('userEmail', email);
                    showApp();
                    loadDashboardData();
                } else {
                    alert('Invalid credentials');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const name = formData.get('name') || e.target.querySelector('input[type="text"]').value;
            const email = formData.get('email') || e.target.querySelector('input[type="email"]').value;
            const password = formData.get('password') || e.target.querySelector('input[type="password"]').value;
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                
                if (response.ok) {
                    alert('Registration successful! Please login.');
                    showLoginBtn.click();
                } else {
                    const error = await response.text();
                    alert(error);
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed');
            }
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('userEmail');
            authWrapper.style.display = 'flex';
            appWrapper.style.display = 'none';
            authWrapper.classList.add('active');
            appWrapper.classList.remove('active');
        }

        function showApp() {
            authWrapper.style.display = 'none';
            appWrapper.style.display = 'flex';
            authWrapper.classList.remove('active');
            appWrapper.classList.add('active');
            navigateToPage('dashboard-page');
        }

        // Navigation
        function navigateToPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === pageId) {
                    btn.classList.add('active');
                }
            });

            currentPage = pageId;
            
            // Load page-specific data
            if (pageId === 'history-page') {
                loadWorkoutHistory();
            } else if (pageId === 'profile-page') {
                loadUserProfile();
            } else if (pageId === 'workouts-page') {
                loadWorkouts();
            }
            
            // Hide mobile menu
            if (mobileNav) {
                mobileNav.classList.remove('active');
            }
        }

        // Charts
        let workoutChart = null;
        let progressChart = null;
        
        function updateCharts(workouts = []) {
            updateWorkoutDistributionChart(workouts);
            updateProgressChart(workouts);
        }
        
        function updateWorkoutDistributionChart(workouts) {
            const workoutCtx = document.getElementById('workoutChart');
            if (!workoutCtx) return;
            
            // Destroy existing chart
            if (workoutChart) {
                workoutChart.destroy();
            }
            
            // Calculate workout type distribution
            const typeCount = {};
            workouts.forEach(workout => {
                const title = workout.title || 'Other';
                const type = title.toLowerCase().includes('strength') ? 'Strength' :
                           title.toLowerCase().includes('cardio') || title.toLowerCase().includes('run') ? 'Cardio' :
                           title.toLowerCase().includes('yoga') || title.toLowerCase().includes('stretch') ? 'Flexibility' : 'Other';
                typeCount[type] = (typeCount[type] || 0) + 1;
            });
            
            const labels = Object.keys(typeCount);
            const data = Object.values(typeCount);
            const colors = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b'];
            
            workoutChart = new Chart(workoutCtx, {
                type: 'doughnut',
                data: {
                    labels: labels.length ? labels : ['No Data'],
                    datasets: [{
                        data: data.length ? data : [1],
                        backgroundColor: labels.length ? colors.slice(0, labels.length) : ['#64748b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#94a3b8', padding: 20 }
                        }
                    },
                    animation: {
                        animateScale: false,
                        animateRotate: false
                    }
                }
            });
        }
        
        function updateProgressChart(workouts) {
            const progressCtx = document.getElementById('progressChart');
            if (!progressCtx) return;
            
            // Destroy existing chart
            if (progressChart) {
                progressChart.destroy();
            }
            
            // Group workouts by month
            const monthlyData = {};
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            workouts.forEach(workout => {
                const date = new Date(workout.date);
                const monthKey = months[date.getMonth()];
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;
            });
            
            // Get last 6 months
            const currentMonth = new Date().getMonth();
            const last6Months = [];
            const last6MonthsData = [];
            
            for (let i = 5; i >= 0; i--) {
                const monthIndex = (currentMonth - i + 12) % 12;
                const monthName = months[monthIndex];
                last6Months.push(monthName);
                last6MonthsData.push(monthlyData[monthName] || 0);
            }
            
            progressChart = new Chart(progressCtx, {
                type: 'bar',
                data: {
                    labels: last6Months,
                    datasets: [{
                        label: 'Workouts Completed',
                        data: last6MonthsData,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
        }

        // API Functions
        async function loadDashboardData() {
            if (!currentUser?.email) return;
            
            try {
                // Load workout summary
                const summaryResponse = await fetch(`/api/workout-history/summary?email=${currentUser.email}`);
                if (summaryResponse.ok) {
                    const summary = await summaryResponse.json();
                    updateDashboardStats(summary);
                }
                
                // Load recent workouts
                const recentResponse = await fetch(`/api/workout-history/recent?email=${currentUser.email}&limit=5`);
                if (recentResponse.ok) {
                    const recentWorkouts = await recentResponse.json();
                    updateRecentWorkouts(recentWorkouts);
                }
                
                // Load workout history for charts
                const historyResponse = await fetch(`/api/workout-history?email=${currentUser.email}&size=30`);
                if (historyResponse.ok) {
                    const historyData = await historyResponse.json();
                    updateCharts(historyData.workouts);
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        function updateDashboardStats(summary) {
            // Update user name
            const nameElement = document.querySelector('#dashboard-page h1');
            if (nameElement && currentUser?.name) {
                nameElement.textContent = `Good Morning, ${currentUser.name.charAt(0).toUpperCase() + currentUser.name.slice(1)}! ðŸ‘‹`;
            }
            
            // Update stats cards (you can customize these based on your data)
            const statsCards = document.querySelectorAll('.stats-grid .glass-effect');
            if (statsCards.length >= 3) {
                // Total workouts
                const totalWorkoutsCard = statsCards[0];
                const workoutCount = totalWorkoutsCard.querySelector('.text-2xl');
                if (workoutCount) workoutCount.textContent = summary.totalWorkouts || 0;
                
                // Total exercises
                const totalExercisesCard = statsCards[1];
                const exerciseCount = totalExercisesCard.querySelector('.text-2xl');
                if (exerciseCount) exerciseCount.textContent = summary.totalExercises || 0;
                
                // Streak (calculate from recent workouts)
                const streakCard = statsCards[2];
                const streakCount = streakCard.querySelector('.text-2xl');
                if (streakCount) streakCount.textContent = Math.floor(summary.averageWorkoutsPerWeek || 0) + ' days';
            }
        }
        
        function updateRecentWorkouts(workouts) {
            const recentContainer = document.querySelector('#dashboard-page .space-y-4');
            if (!recentContainer || !workouts.length) return;
            
            recentContainer.innerHTML = workouts.map(workout => {
                const date = new Date(workout.date).toLocaleDateString();
                const exerciseCount = workout.exercises?.length || 0;
                
                return `
                    <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-xl">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-dumbbell text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-white font-medium">${workout.title || 'Workout'}</h4>
                            <p class="text-slate-400 text-sm">${exerciseCount} exercises</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white text-sm">${date}</p>
                            <p class="text-green-400 text-sm">Completed</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        async function loadWorkoutHistory() {
            if (!currentUser?.email) return;
            
            try {
                const response = await fetch(`/api/workout-history?email=${currentUser.email}&size=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateWorkoutHistory(data.workouts);
                }
            } catch (error) {
                console.error('Error loading workout history:', error);
            }
        }
        
        function populateWorkoutHistory(workouts = []) {
            const historyContainer = document.getElementById('workout-history');
            if (!historyContainer) return;
            
            if (!workouts.length) {
                historyContainer.innerHTML = '<p class="text-slate-400 text-center py-8">No workout history found. Start your first workout!</p>';
                return;
            }

            historyContainer.innerHTML = workouts.map(workout => {
                const date = new Date(workout.date).toLocaleDateString();
                const exerciseCount = workout.exercises?.length || 0;
                
                return `
                    <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-xl card-hover">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-dumbbell text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-white font-medium">${workout.title || 'Workout Session'}</h4>
                            <p class="text-slate-400 text-sm">${exerciseCount} exercises</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white text-sm">${date}</p>
                            <p class="text-green-400 text-sm">Completed</p>
                        </div>
                        <button onclick="deleteWorkout(${workout.id})" class="text-red-400 hover:text-red-300 p-2">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        async function deleteWorkout(workoutId) {
            if (!confirm('Are you sure you want to delete this workout?')) return;
            
            try {
                const response = await fetch(`/api/workout-history/${workoutId}?email=${currentUser.email}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadWorkoutHistory(); // Reload the list
                    loadDashboardData(); // Update dashboard stats
                } else {
                    alert('Failed to delete workout');
                }
            } catch (error) {
                console.error('Error deleting workout:', error);
                alert('Failed to delete workout');
            }
        }

        // Workout Functions
        let exerciseCounter = 0;
        
        const workoutTemplates = {
            strength: {
                title: 'Strength Training Session',
                exercises: [
                    { name: 'Bench Press', sets: 3, reps: 10 },
                    { name: 'Squats', sets: 3, reps: 12 },
                    { name: 'Deadlifts', sets: 3, reps: 8 },
                    { name: 'Pull-ups', sets: 3, reps: 8 },
                    { name: 'Overhead Press', sets: 3, reps: 10 }
                ]
            },
            cardio: {
                title: 'Cardio Blast Workout',
                exercises: [
                    { name: 'Jumping Jacks', sets: 3, reps: 30 },
                    { name: 'Burpees', sets: 3, reps: 15 },
                    { name: 'Mountain Climbers', sets: 3, reps: 20 },
                    { name: 'High Knees', sets: 3, reps: 30 },
                    { name: 'Plank Jacks', sets: 3, reps: 20 },
                    { name: 'Jump Squats', sets: 3, reps: 15 }
                ]
            },
            flexibility: {
                title: 'Flexibility & Mobility Session',
                exercises: [
                    { name: 'Cat-Cow Stretch', sets: 2, reps: 10 },
                    { name: 'Downward Dog', sets: 2, reps: 5 },
                    { name: 'Hip Flexor Stretch', sets: 2, reps: 8 },
                    { name: 'Shoulder Rolls', sets: 2, reps: 10 },
                    { name: 'Hamstring Stretch', sets: 2, reps: 6 },
                    { name: 'Spinal Twist', sets: 2, reps: 8 },
                    { name: 'Child\'s Pose', sets: 1, reps: 3 },
                    { name: 'Pigeon Pose', sets: 2, reps: 4 }
                ]
            }
        };
        
        function setupWorkoutEventListeners() {
            const createWorkoutBtn = document.getElementById('create-workout-btn');
            const workoutModal = document.getElementById('workout-modal');
            const closeModal = document.getElementById('close-modal');
            const cancelWorkout = document.getElementById('cancel-workout');
            const addExerciseBtn = document.getElementById('add-exercise');
            const workoutForm = document.getElementById('workout-form');
            
            if (createWorkoutBtn) {
                createWorkoutBtn.addEventListener('click', openWorkoutModal);
            }
            
            if (closeModal) {
                closeModal.addEventListener('click', closeWorkoutModal);
            }
            
            if (cancelWorkout) {
                cancelWorkout.addEventListener('click', closeWorkoutModal);
            }
            
            if (addExerciseBtn) {
                addExerciseBtn.addEventListener('click', addExerciseRow);
            }
            
            if (workoutForm) {
                workoutForm.addEventListener('submit', saveWorkout);
            }
            
            // Close modal on backdrop click
            if (workoutModal) {
                workoutModal.addEventListener('click', (e) => {
                    if (e.target === workoutModal) {
                        closeWorkoutModal();
                    }
                });
            }
        }
        
        function openWorkoutModal() {
            if (!currentUser?.email) {
                alert('Please login first');
                return;
            }
            
            const modal = document.getElementById('workout-modal');
            if (modal) {
                modal.style.display = 'flex';
                resetWorkoutForm();
                addExerciseRow(); // Add first exercise row
            }
        }
        
        function closeWorkoutModal() {
            const modal = document.getElementById('workout-modal');
            if (modal) {
                modal.style.display = 'none';
                resetWorkoutForm();
            }
        }
        
        function resetWorkoutForm() {
            const titleInput = document.getElementById('workout-title');
            const exercisesContainer = document.getElementById('exercises-container');
            
            if (titleInput) titleInput.value = '';
            if (exercisesContainer) exercisesContainer.innerHTML = '';
            exerciseCounter = 0;
        }
        
        function addExerciseRow(exercise = null) {
            const container = document.getElementById('exercises-container');
            if (!container) return;
            
            const exerciseId = ++exerciseCounter;
            const exerciseRow = document.createElement('div');
            exerciseRow.className = 'bg-slate-800/30 rounded-xl p-4 space-y-4 exercise-row border border-slate-700/50 hover:border-slate-600/50 transition-all';
            exerciseRow.id = `exercise-${exerciseId}`;
            
            exerciseRow.innerHTML = `
                <div class="flex items-center justify-between">
                    <h4 class="text-white font-medium flex items-center gap-2">
                        <i class="fas fa-dumbbell text-blue-400 text-sm"></i>
                        Exercise ${exerciseId}
                    </h4>
                    <button type="button" onclick="removeExercise(${exerciseId})" class="text-red-400 hover:text-red-300 p-2 hover:bg-red-500/10 rounded-lg transition-all">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="md:col-span-1">
                        <label class="block text-sm text-slate-300 mb-2">Exercise Name</label>
                        <input type="text" name="exercise-name-${exerciseId}" class="form-input w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Push-ups" value="${exercise?.name || ''}" required>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-300 mb-2">Sets</label>
                        <input type="number" name="exercise-sets-${exerciseId}" min="1" max="20" class="form-input w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="${exercise?.sets || 3}" required>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-300 mb-2">Reps</label>
                        <input type="number" name="exercise-reps-${exerciseId}" min="1" max="100" class="form-input w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="${exercise?.reps || 10}" required>
                    </div>
                </div>
            `;
            
            container.appendChild(exerciseRow);
        }
        
        function removeExercise(exerciseId) {
            const exerciseRow = document.getElementById(`exercise-${exerciseId}`);
            if (exerciseRow) {
                exerciseRow.remove();
            }
        }
        
        function createFromTemplate(templateType) {
            if (!currentUser?.email) {
                alert('Please login first');
                return;
            }
            
            const template = workoutTemplates[templateType];
            if (!template) return;
            
            openWorkoutModal();
            
            // Set title
            const titleInput = document.getElementById('workout-title');
            if (titleInput) {
                titleInput.value = template.title;
            }
            
            // Clear existing exercises and add template exercises
            const container = document.getElementById('exercises-container');
            if (container) {
                container.innerHTML = '';
                exerciseCounter = 0;
                
                template.exercises.forEach(exercise => {
                    addExerciseRow(exercise);
                });
            }
        }
        
        async function saveWorkout(e) {
            e.preventDefault();
            
            if (!currentUser?.email) {
                showToast('Please login first', 'error');
                return;
            }
            
            const titleInput = document.getElementById('workout-title');
            const title = titleInput?.value?.trim();
            
            if (!title) {
                showToast('Please enter a workout title', 'error');
                titleInput?.focus();
                return;
            }
            
            // Collect exercises
            const exercises = [];
            const container = document.getElementById('exercises-container');
            
            if (container) {
                const exerciseRows = container.querySelectorAll('[id^="exercise-"]');
                
                exerciseRows.forEach(row => {
                    const nameInput = row.querySelector('[name^="exercise-name-"]');
                    const setsInput = row.querySelector('[name^="exercise-sets-"]');
                    const repsInput = row.querySelector('[name^="exercise-reps-"]');
                    
                    const name = nameInput?.value?.trim();
                    const sets = parseInt(setsInput?.value) || 0;
                    const reps = parseInt(repsInput?.value) || 0;
                    
                    if (name && sets > 0 && reps > 0) {
                        exercises.push({ name, sets, reps });
                    }
                });
            }
            
            if (exercises.length === 0) {
                showToast('Please add at least one exercise', 'error');
                return;
            }
            
            // Show loading state
            const saveBtn = document.getElementById('save-workout-btn');
            const originalText = saveBtn?.innerHTML;
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.classList.add('btn-loading');
                saveBtn.innerHTML = 'Saving...';
            }
            
            try {
                const response = await fetch(`/api/workouts?email=${encodeURIComponent(currentUser.email)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, exercises })
                });
                
                if (response.ok) {
                    closeWorkoutModal();
                    showToast('Workout saved successfully! ðŸ’ª');
                    await loadDashboardData();
                    if (currentPage === 'workouts-page') {
                        await loadWorkouts();
                    }
                    if (currentPage === 'history-page') {
                        await loadWorkoutHistory();
                    }
                } else {
                    const errorText = await response.text();
                    console.error('Workout save error:', errorText);
                    showToast('Failed to save workout: ' + errorText, 'error');
                }
            } catch (error) {
                console.error('Error saving workout:', error);
                showToast('Failed to save workout: ' + error.message, 'error');
            } finally {
                // Reset button state
                if (saveBtn && originalText) {
                    saveBtn.disabled = false;
                    saveBtn.classList.remove('btn-loading');
                    saveBtn.innerHTML = originalText;
                }
            }
        }
        
        async function loadWorkouts() {
            if (!currentUser?.email) return;
            
            try {
                const response = await fetch(`/api/workouts?email=${encodeURIComponent(currentUser.email)}`);
                if (response.ok) {
                    const workouts = await response.json();
                    displayRecentWorkouts(workouts);
                }
            } catch (error) {
                console.error('Error loading workouts:', error);
            }
        }
        
        function displayRecentWorkouts(workouts) {
            const container = document.getElementById('recent-workouts');
            if (!container) return;
            
            if (!workouts || workouts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-slate-400">
                        <i class="fas fa-dumbbell text-4xl mb-4 opacity-50"></i>
                        <p>No workouts yet. Create your first workout!</p>
                    </div>
                `;
                return;
            }
            
            // Show only the 5 most recent workouts
            const recentWorkouts = workouts.slice(0, 5);
            
            container.innerHTML = recentWorkouts.map(workout => {
                const date = new Date(workout.date).toLocaleDateString();
                const exerciseCount = workout.exercises?.length || 0;
                const totalSets = workout.exercises?.reduce((sum, ex) => sum + ex.sets, 0) || 0;
                
                return `
                    <div class="group flex items-center gap-4 p-4 bg-slate-800/30 rounded-xl card-hover workout-card border border-slate-700/50">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-dumbbell text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-white font-medium">${workout.title}</h4>
                            <p class="text-slate-400 text-sm">${exerciseCount} exercises â€¢ ${totalSets} total sets</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white text-sm">${date}</p>
                            <p class="text-green-400 text-sm flex items-center gap-1">
                                <i class="fas fa-check-circle text-xs"></i>
                                Completed
                            </p>
                        </div>
                        <button onclick="deleteWorkout(${workout.id})" class="text-red-400 hover:text-red-300 p-2 opacity-0 group-hover:opacity-100 transition-all hover:bg-red-500/10 rounded-lg">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        // Legacy function for backward compatibility
        async function startWorkout() {
            openWorkoutModal();
        }

        // Profile Functions
        async function loadUserProfile() {
            if (!currentUser?.email) return;
            
            try {
                const response = await fetch(`/api/users/profile?email=${encodeURIComponent(currentUser.email)}`);
                if (response.ok) {
                    const user = await response.json();
                    updateProfileForm(user);
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }
        
        function updateProfileForm(user) {
            const profileForm = document.querySelector('#profile-page form');
            if (!profileForm) return;
            
            const nameInput = profileForm.querySelector('input[name="name"]');
            const emailInput = profileForm.querySelector('input[name="email"]');
            const ageInput = profileForm.querySelector('input[name="age"]');
            const heightInput = profileForm.querySelector('input[name="height"]');
            const weightInput = profileForm.querySelector('input[name="weight"]');
            
            if (nameInput) nameInput.value = user.name || '';
            if (emailInput) emailInput.value = user.email || '';
            if (ageInput) ageInput.value = user.age || '';
            if (heightInput) heightInput.value = user.height || '';
            if (weightInput) weightInput.value = user.weight || '';
            
            // Update profile display
            const profileName = document.getElementById('profile-display-name');
            const profileEmail = document.getElementById('profile-display-email');
            if (profileName) profileName.textContent = user.name || user.email;
            if (profileEmail) profileEmail.textContent = user.email || '';
            
            // Show BMI if available
            if (user.bmi) {
                const bmiDisplay = document.getElementById('bmi-display');
                const bmiValue = document.getElementById('bmi-value');
                if (bmiDisplay && bmiValue) {
                    bmiDisplay.style.display = 'block';
                    bmiValue.textContent = user.bmi.toFixed(1);
                }
            }
            
            // Update currentUser with latest data
            currentUser = { ...currentUser, ...user };
            
            // Update stats
            loadProfileStats();
        }
        
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast glass-effect rounded-xl p-4 flex items-center gap-3 min-w-80`;
            
            const icon = type === 'success' ? 'fa-check-circle text-green-400' : 'fa-exclamation-circle text-red-400';
            toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <span class="text-white">${message}</span>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        async function updateProfile(e) {
            e.preventDefault();
            if (!currentUser?.email) return;
            
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const age = parseInt(formData.get('age')) || null;
            const height = parseFloat(formData.get('height')) || null;
            const weight = parseFloat(formData.get('weight')) || null;
            
            try {
                const response = await fetch(`/api/users/profile?email=${encodeURIComponent(currentUser.email)}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, age, height, weight })
                });
                
                if (response.ok) {
                    const updatedUser = await response.json();
                    currentUser = { ...currentUser, ...updatedUser };
                    showToast('Profile updated successfully!');
                    updateProfileForm(updatedUser);
                    loadProfileStats();
                } else {
                    showToast('Failed to update profile', 'error');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('Failed to update profile', 'error');
            }
        }
        
        async function loadProfileStats() {
            if (!currentUser?.email) return;
            
            try {
                const response = await fetch(`/api/workout-history/summary?email=${encodeURIComponent(currentUser.email)}`);
                if (response.ok) {
                    const summary = await response.json();
                    updateProfileStats(summary);
                }
            } catch (error) {
                console.error('Error loading profile stats:', error);
            }
        }
        
        function updateProfileStats(summary) {
            const statsContainer = document.getElementById('profile-stats');
            if (!statsContainer) return;
            
            const statItems = statsContainer.querySelectorAll('.flex.justify-between');
            if (statItems.length >= 4) {
                statItems[0].querySelector('.font-semibold').textContent = summary.totalWorkouts || 0;
                statItems[1].querySelector('.font-semibold').textContent = summary.totalExercises || 0;
                statItems[2].querySelector('.font-semibold').textContent = currentUser?.bmi ? currentUser.bmi.toFixed(1) : '-';
                
                // Calculate member since (assuming user creation date from oldest workout or current date)
                const memberSince = summary.oldestWorkout ? 
                    new Date(summary.oldestWorkout).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 
                    new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                statItems[3].querySelector('.font-semibold').textContent = memberSince;
            }
        }
        
        function calculateBMI() {
            const heightInput = document.querySelector('input[name="height"]');
            const weightInput = document.querySelector('input[name="weight"]');
            const bmiDisplay = document.getElementById('bmi-display');
            const bmiValue = document.getElementById('bmi-value');
            
            if (heightInput && weightInput && bmiDisplay && bmiValue) {
                const height = parseFloat(heightInput.value);
                const weight = parseFloat(weightInput.value);
                
                if (height > 0 && weight > 0) {
                    const heightInMeters = height / 100;
                    const bmi = weight / (heightInMeters * heightInMeters);
                    bmiDisplay.style.display = 'block';
                    bmiValue.textContent = bmi.toFixed(1);
                } else {
                    bmiDisplay.style.display = 'none';
                }
            }
        }
        
        // Responsive behavior
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                mobileNav.classList.remove('active');
            }
        });
    </script>
</body>
</html>